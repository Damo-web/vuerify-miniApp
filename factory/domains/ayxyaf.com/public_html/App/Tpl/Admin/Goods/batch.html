<tagLib name="html"/>
<include file="Public:header" />
<body>
    <div class="subTit">
            <div class="tit">
                <a href="javascript:;">产品</a>&gt;<a href="javascript:;">批量增加产品</a>
            </div>
     </div>
            <div class="content">
                <div class="formMod">
                    <div class="tit">批量增加产品</div>
                    <form name="form1" id="form1" enctype="multipart/form-data" method="post" action="">
                        <input type="hidden" id="p" name="p" value="{$p}" />
                        <ul>
                            <li>
                                <label for="category">产品类别：</label>
                                <html:select options='category' selected='classid' name="pid" id="pid" style="txt" />
                            </li>                            
                            <li>
                                <label for="">产品标题：</label>
                                <div class="item_cont">
                                    <label><input type="radio" name="titleBy" value="1" checked=""> 根据文件名</label>
                                    <label><input type="radio" name="titleBy" value="0"> 统一命名</label>
                                    <p class="notice">注意：请提前修改好图片名称，图片名称会自动同步为产品名称！</p>
                                    <input type="text" name="title" size="80" class="txt" id="title" style="display:none;" />
                                </div>
                            </li>
                            <li>
                                <label for="img">产品图片：</label>
                                <div name="img">
                                    <div class="item_cont">
                                        <div>
                                            <input id="file_upload" name="file_upload" type="file" multiple="true">
                                            <p id="disabled-btn">批量上传</p>
                                            <span class="txt-maxnum">支持图片格式：jpg/jpeg/gif/png，每张图片最大2MB</span>
                                            <span class="txt-tipmsg"></span>                                            
                                            <div id="imgInput" class="uploadify-queue">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </li>
                            <li class="push">
                                <div class="item_cont">
                                    <input type="hidden" name="batch" value="1">
                                    <input type="button" class="submit" id="upload" value="批量上传" />
                                    <input type="button" class="reset"  id="cancel" value="取消上传" />
                                </div>
                            </li>
                        </ul>
                    </form>
                </div>
            </div>
            <load href="../Public/Js/uploadify/uploadify.css" />
            <load href="../Public/Js/uploadify/jquery.uploadify.min.js" />
            <script type="text/javascript">
                $('input[name=titleBy]').change(function() {
                    if ($(this).val()==1) {
                        $('#title').hide();
                        $('p.notice').show();
                    } else{
                        $('p.notice').hide();
                        $('#title').show();
                    };                   
                });                
                $('#file_upload').uploadify({
                      'swf'      : '../Public/Js/uploadify/uploadify.swf',
                      'uploader' : '__GROUP__/Goods/batch',
                      'formData': { '<?php echo session_name();?>': '<?php echo session_id();?>'},
                      'fileSizeLimit' : '2MB',             //文件大小
                      'fileTypeExts' : '*.jpg; *.jpeg; *.png; *.gif', //文件类型
                      'buttonText' : '选择文件',
                      'queueID' : 'imgInput',
                      'height' : 26,
                      'width'  : 80,
                      'fileObjName' : 'img',
                      'auto'     : false,
                      'onUploadSuccess' : function(file,data,respone) {
                          if(!respone) {
                              alert(file.name+'上传失败');
                          }
                      },
                });
                $('#upload').click(function() {
                     if($('#pid').val() == 1){
                        alert('请选择产品分类');
                        $("#pid").focus();
                        return false;
                    }
                    if ($('input[name=titleBy]:checked').val()==0&&$.trim($('#title').val())=='') {
                        alert('请填写产品标题');
                        $('#title').focus();
                        return false;
                    }
                    // 添加参数
                    var formData=$('#file_upload').uploadify('settings','formData');
                    formData['pid']=$('#pid').val();
                    formData['titleby']=$('input[name=titleBy]:checked').val();
                    if ($('input[name=titleBy]:checked').val()==0) {
                        formData['title']=$('#title').val();
                    } 
                                        
                    $('#file_upload').uploadify('settings','formData',formData);
                    $('#file_upload').uploadify('upload','*');
                    this.blur(); 
                });
                $('#cancel').click(function() {
                    $('#file_upload').uploadify('cancel','*');
                    this.blur();
                });
            </script>
</body>
</html>